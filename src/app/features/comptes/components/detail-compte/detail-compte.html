<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>

<div class="max-w-4xl mx-auto px-6 py-10">
  @if (compte$ | async; as compte) {

  <!-- Breadcrumb -->
  <div class="flex items-center gap-2 text-sm text-gray-400 mb-8">
    <a routerLink="/comptes" class="hover:text-blue-700 transition-colors no-underline text-gray-400">Mes Comptes</a>
    <span class="pi pi-chevron-right text-xs"></span>
    <span class="text-gray-600 font-medium">{{ compte.titulaire }}</span>
  </div>

  <!-- Top card with balance -->
  <div class="bg-white border border-gray-100 rounded-2xl p-8 mb-6 shadow-sm">
    <div class="flex justify-between items-start">
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-xl" [class]="compte.type === 'COURANT'
                 ? 'bg-blue-50 text-blue-700'
                 : 'bg-emerald-50 text-emerald-600'">
          <span [class]="compte.type === 'COURANT' ? 'pi pi-wallet' : 'pi pi-bookmark'"></span>
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-900">{{ compte.titulaire }}</h1>
          <p class="text-sm text-gray-400 font-mono tracking-wide mt-0.5">{{ compte.compteNumber }}</p>
          <p-tag class="mt-2 inline-block" [value]="compte.type === 'COURANT' ? 'Compte Courant' : 'Compte Épargne'"
            [severity]="compte.type === 'COURANT' ? 'info' : 'success'" [rounded]="true" />
        </div>
      </div>

      <div class="text-right">
        <p class="text-xs text-gray-400 uppercase tracking-wider font-medium mb-1">Solde disponible</p>
        <p class="text-3xl font-bold tracking-tight" [class]="compte.solde >= 0 ? 'text-gray-900' : 'text-red-500'">
          {{ compte.solde | number:'1.2-2' }}&nbsp;€
        </p>
      </div>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="grid grid-cols-3 gap-4 mb-6">
    <button (click)="ouvrirModal('depot')" class="flex items-center justify-center gap-3 bg-white border border-gray-100 rounded-2xl p-5
                     hover:border-emerald-200 hover:bg-emerald-50/50 transition-all duration-200 cursor-pointer group">
      <div class="w-10 h-10 rounded-xl bg-emerald-50 text-emerald-600 flex items-center justify-center
                    group-hover:bg-emerald-100 transition-colors">
        <span class="pi pi-arrow-down text-sm"></span>
      </div>
      <span class="text-sm font-semibold text-gray-700 group-hover:text-emerald-700">Déposer</span>
    </button>

    <button (click)="ouvrirModal('retrait')" class="flex items-center justify-center gap-3 bg-white border border-gray-100 rounded-2xl p-5
                     hover:border-orange-200 hover:bg-orange-50/50 transition-all duration-200 cursor-pointer group">
      <div class="w-10 h-10 rounded-xl bg-orange-50 text-orange-500 flex items-center justify-center
                    group-hover:bg-orange-100 transition-colors">
        <span class="pi pi-arrow-up text-sm"></span>
      </div>
      <span class="text-sm font-semibold text-gray-700 group-hover:text-orange-700">Retirer</span>
    </button>

    <button (click)="suppCompte()" class="flex items-center justify-center gap-3 bg-white border border-gray-100 rounded-2xl p-5
                     hover:border-red-200 hover:bg-red-50/50 transition-all duration-200 cursor-pointer group">
      <div class="w-10 h-10 rounded-xl bg-red-50 text-red-400 flex items-center justify-center
                    group-hover:bg-red-100 transition-colors">
        <span class="pi pi-trash text-sm"></span>
      </div>
      <span class="text-sm font-semibold text-gray-700 group-hover:text-red-600">Supprimer</span>
    </button>
  </div>

  <!-- Modal -->
  <p-dialog [header]="operationType === 'depot' ? 'Déposer de l\'argent' : 'Retirer de l\'argent'"
    [(visible)]="showModal" [modal]="true" [style]="{ width: '420px' }" [draggable]="false" [resizable]="false"
    styleClass="rounded-2xl">

    <div class="py-2">
      <label class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Montant (€)</label>
      <div class="relative">
        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 font-medium">€</span>
        <input type="number" [(ngModel)]="montant" placeholder="0.00" class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl text-gray-900 text-lg font-medium
                   placeholder:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400
                   transition-all duration-200" />
      </div>
    </div>

    <ng-template #footer>
      <div class="flex gap-3 justify-end">
        <button (click)="fermerModal()" class="px-5 py-2.5 rounded-xl border border-gray-200 text-gray-600 text-sm font-medium
                         hover:bg-gray-50 transition-all cursor-pointer">
          Annuler
        </button>
        <button (click)="confirmerOperation()"
          class="px-5 py-2.5 rounded-xl text-white text-sm font-semibold transition-all cursor-pointer" [class]="operationType === 'depot'
                    ? 'bg-emerald-600 hover:bg-emerald-700 shadow-md shadow-emerald-600/20'
                    : 'bg-orange-500 hover:bg-orange-600 shadow-md shadow-orange-500/20'">
          Confirmer
        </button>
      </div>
    </ng-template>
  </p-dialog>

  } @else {
  <div class="text-center py-24">
    <span class="pi pi-spin pi-spinner text-3xl text-gray-300 block mb-4"></span>
    <p class="text-gray-400">Chargement des détails du compte…</p>
  </div>
  }
</div>